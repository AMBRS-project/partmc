<html>
<head><title>PartMC 2.0.0</title></head>
<body bgcolor="#ffffff">
<h1>PartMC</h1>

<p>PartMC: Particle-resolved Monte Carlo code for atmospheric aerosol simulation</p>

<p>Version 2.0.0 <br />
Released 2011-01-02</p>

<p><a href="http://lagrange.mechse.illinois.edu/mwest/partmc/">http://lagrange.mechse.illinois.edu/mwest/partmc/</a></p>

<p>References:</p>

<ul>
<li>N. Riemer, M. West, R. A. Zaveri, and R. C. Easter (2009),
 Simulating the evolution of soot mixing state with a
 particle-resolved aerosol model, J. Geophys. Res. 114(D09202),
 <a href="http://dx.doi.org/10.1029/2008JD011073">http://dx.doi.org/10.1029/2008JD011073</a>.</li>
<li>N. Riemer, M. West, R. A. Zaveri, and R. C. Easter (2010),
 Estimating black carbon aging time-scales with a
 particle-resolved aerosol model, J. Aerosol Sci. 41(1), 143-158,
 <a href="http://dx.doi.org/10.1016/j.jaerosci.2009.08.009">http://dx.doi.org/10.1016/j.jaerosci.2009.08.009</a>.</li>
<li>R. A. Zaveri, R. C. Easter, J. C. Barnard, N. Riemer, and M. West
 (2010), Particle-resolved simulation of aerosol size,
 composition, mixing state, and the associated optical and cloud
 condensation nuclei activation properties in an evolving urban
 plume, J. Geophys. Res. 115(D17210),
 <a href="http://dx.doi.org/10.1029/2009JD013616">http://dx.doi.org/10.1029/2009JD013616</a>.</li>
</ul>

<p>Copyright (C) 2005-2011 Nicole Riemer and Matthew West <br />
Portions copyright (C) Andreas Bott and Richard Easter <br />
Licensed under the GNU General Public License version 2 or (at your
option) any later version. <br />
For details see the file COPYING or
<a href="http://www.gnu.org/licenses/old-licenses/gpl-2.0.html">http://www.gnu.org/licenses/old-licenses/gpl-2.0.html</a>.</p>

<h1>Dependencies</h1>

<p>Required dependencies:</p>

<ul>
<li>Fortran 90/95 compiler</li>
<li>cmake version 2.6 or higher - <a href="http://www.cmake.org/">http://www.cmake.org/</a></li>
<li>NetCDF - <a href="http://www.unidata.ucar.edu/software/netcdf/">http://www.unidata.ucar.edu/software/netcdf/</a></li>
</ul>

<p>Optional dependencies:</p>

<ul>
<li>MOSAIC - Available from Rahul Zaveri - <a href="&#109;&#97;&#105;&#x6c;&#x74;&#111;&#58;R&#97;&#x68;&#x75;l.&#90;&#97;&#118;&#101;&#114;&#x69;&#64;&#112;&#x6e;&#x6c;&#x2e;&#103;o&#x76;">R&#97;&#x68;&#x75;l.&#90;&#97;&#118;&#101;&#114;&#x69;&#64;&#112;&#x6e;&#x6c;&#x2e;&#103;o&#x76;</a></li>
<li>MPI - <a href="http://www.open-mpi.org/">http://www.open-mpi.org/</a></li>
<li>SUNDIALS - <a href="http://www.llnl.gov/casc/sundials/">http://www.llnl.gov/casc/sundials/</a></li>
<li>gnuplot - <a href="http://www.gnuplot.info/">http://www.gnuplot.info/</a></li>
</ul>

<p>PartMC can be compiled out-of-the-box on Linux if the following
packages are installed:</p>

<ul>
<li>Fedora 14: <code>gcc-gfortran</code>, <code>cmake</code>, <code>netcdf-devel</code>, <code>gnuplot</code></li>
<li>Ubuntu 10.04: <code>gfortran</code>, <code>cmake-curses-gui</code>, <code>libnetcdf-dev</code>, <code>gnuplot</code></li>
<li>openSUSE 11.3: <code>gcc-fortran</code>, <code>cmake</code>, <code>libnetcdf-devel</code>, <code>gnuplot</code></li>
<li>Debian 5.0: <code>gfortran</code>, <code>make</code>, <code>cmake</code>, <code>libnetcdf-dev</code>, <code>gnuplot</code></li>
</ul>

<h1>Installation</h1>

<p>In principle PartMC should compile under any modern OS. Testing has
mainly been under Linux and OS X. The quick-start instructions are:</p>

<ol>
<li><p>Install cmake and NetCDF (see above). The NetCDF libraries are
required to compile PartMC. The <code>netcdf.mod</code> Fortran 90 module file
is required, and it must be produced by the same compiler being
used to compile PartMC.</p></li>
<li><p>Unpack PartMC:</p>

<pre><code>tar xzvf partmc-2.0.0.tar.gz
</code></pre></li>
<li><p>Change into the main PartMC directory (where this README file is
located):</p>

<pre><code>cd partmc-2.0.0
</code></pre></li>
<li><p>Make a directory called <code>build</code> and change into it:</p>

<pre><code>mkdir build
cd build
</code></pre></li>
<li><p>Run cmake with the main PartMC directory as an argument (note the
double-c):</p>

<pre><code>ccmake ..
</code></pre></li>
<li><p>Inside ccmake press <code>c</code> to configure, edit the values as needed,
press <code>c</code> again, then <code>g</code> to generate.</p></li>
<li><p>Compile PartMC and test it as follows. Some tests may fail due to
bad random initial conditions, so re-run the tests a few times to
see if failures persist.</p>

<pre><code>make
make test
</code></pre></li>
<li><p>To run just a single test do something like:</p>

<pre><code>ctest -R poisson # argument is a regexp for test names
</code></pre></li>
<li><p>To see what make is doing run it like:</p>

<pre><code>VERBOSE=1 make
</code></pre></li>
<li><p>To run tests with visible output or to make some plots from the
tests run them as:</p>

<pre><code>cd run_test/emission
./run_test_1.sh
./run_test_2.sh
./run_test_3.sh                       # similarly for other tests
gnuplot -persist plot_species.gnuplot # etc...
</code></pre></li>
<li><p>To run full scenarios, do, for example:</p>

<pre><code>cd ../scenarios/1_urban_plume
./run.sh
</code></pre></li>
</ol>

<p>PartMC can interface to the MOSAIC chemistry code (see above for
availability) but this is not enabled by default. This version of
PartMC has been tested with the <code>mosaic-2011-01-02</code> version. To use
MOSAIC, set the <code>ENABLE_MOSAIC</code> variable to <code>ON</code> in cmake. The
<code>MOSAIC_INCLUDE_DIR</code> variable should be the location of the MOSAIC
module files (compiled with the same compiler), probably ending in
<code>mosaic/datamodules</code>. The <code>MOSAIC_LIB</code> variable should end in
something like <code>mosaic/libmosaic.a</code>.</p>

<p>The condensation code in PartMC requires SUNDIALS version 2.4.0 (not
enabled by default). To use it, set the <code>ENABLE_SUNDIALS</code> variable to
<code>ON</code>. The <code>SUNDIALS_CVODE_LIB</code> variable should be the location of the
<code>libsundials_cvode</code> library, the <code>SUNDIALS_NVECSERIAL_LIB</code> variable
should be the location of the <code>libsundials_nvecserial</code> library, and
<code>SUNDIALS_INCLUDE_DIR</code> should be the base directory that contains the
cvode header directory.</p>

<p>To compile PartMC to enable parallel execution with MPI, set the
<code>ENABLE_MPI</code> variable to <code>ON</code>. Then in the advaced mode section of
cmake set the <code>CMAKE_Fortran_COMPILER</code> to <code>mpif90</code> (or other MPI
compiler wrapper as appropriate) and reconfigure cmake. The <code>partmc</code>
executable should then be lauched with <code>mpirun -np 2 partmc</code> or
similar.</p>

<h1>Usage</h1>

<p>The main <code>partmc</code> command reads <code>.spec</code> files and does the run
specified therein. Either particle-resolved runs, sectional-code runs,
or exact solutions can be generated. A run produces one NetCDF file
per timestep, containing per-particle data (from particle-resolved
runs) or binned data (from sectional or exact runs). The <code>extract_*</code>
programs can read these per-timestep NetCDF files and output ASCII
data (the <code>extract_sectional_*</code> programs are used for sectional and
exact model output).</p>

<h1>ChangeLog</h1>

<p>2.0.0 - 2011-01-02</p>

<ul>
<li><p>Parallel implementations based on remote particle access.</p></li>
<li><p>Added restart capability from NetCDF state files.</p></li>
<li><p>Added partmc.py library for python-based analysis of PartMC output
files.</p></li>
<li><p>Reimplemented water condensation to be much faster and also correct.</p></li>
<li><p>Nucleation added with parameterization due to Kuang, McMurray, et al.</p></li>
<li><p>Weighted particles, with full support for coagulation and MOSAIC.</p></li>
<li><p>Changed to Poisson sampling for coagulation test number.</p></li>
<li><p>Input and output now use diameter everywhere rather than radius.</p></li>
<li><p><code>urban_plume2</code> test-case added, as described in the paper
 <a href="http://dx.doi.org/10.1029/2009JD013616">http://dx.doi.org/10.1029/2009JD013616</a>.</p></li>
</ul>

<p>1.2.0 - 2009-06-15</p>

<ul>
<li><p>Output of full per-particle data in NetCDF format.</p></li>
<li><p><code>urban_plume</code> test-case added, as described in the paper
<a href="http://dx.doi.org/10.1029/2008JD011073">http://dx.doi.org/10.1029/2008JD011073</a>.</p></li>
<li><p>Build system switched to <code>cmake</code>.</p></li>
<li><p>Automated test suite added (<code>make test</code>).</p></li>
</ul>

<p>1.1.0 - 2008-02-17</p>

<ul>
<li><p>Internal reorganization to use Fortran 90 derived types for the
data structures.</p></li>
<li><p>Integration with the MOSAIC gas- and aerosol-chemistry code.</p></li>
<li><p>Output is in binary NetCDF format.</p></li>
<li><p>Parallel implementation using 1D mixing.</p></li>
</ul>

<p>1.0.0 - 2007-02-26</p>

<ul>
<li>First release, including hierarchical coagulation and full water
condensation.</li>
</ul>
</body></html>
