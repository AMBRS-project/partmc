
PartMC
======

PartMC - Particle-resolved Monte Carlo code for atmospheric aerosol simulation

Version 1.2.0  
Released 2009-02-17

<http://lagrange.mechse.uiuc.edu/mwest/partmc/>

Copyright (C) 2005-2009 Nicole Riemer and Matthew West  
Portions copyright (C) Andreas Bott and Richard Easter  
Licensed under the GNU General Public License version 2 or (at your
option) any later version.  
For details see the file COPYING or
<http://www.gnu.org/licenses/old-licenses/gpl-2.0.html>.


Dependencies
============

Required dependencies:

   * Fortran 90 compiler
   * cmake - <http://www.cmake.org/>
   * NetCDF - <http://www.unidata.ucar.edu/software/netcdf/>

Optional dependencies:

   * MOSAIC - Available from Rahul Zaveri - <Rahul.Zaveri@pnl.gov>

PartMC can be compiled out-of-the-box on Fedora 10 with all
dependencies except MOSAIC if the following packages are installed:

   * gcc-gfortran-4.3.2-7
   * cmake-2.6.2-3.fc10
   * netcdf-4.0.0-1.fc10


Installation
============

In principle PartMC should compile under any modern OS. Testing has
mainly been under Linux and OS X. The quick-start instructions under
Linux are:

1. Unpack PartMC with something like:
     tar xzvf partmc-1.2.0.tar.gz

2. Change into the main PartMC directory (where this README file is
   located) with something like:
     cd partmc-1.2.0

3. Make a directory called `build` and change into it:
     mkdir build
     cd build

4. Run cmake with (note the double-c):
     ccmake ..

5. Inside ccmake press `c`, edit the values as needed, press `c`
   again, then `g`.

6. Compile PartMC and test it:
     make
     make test

7. To run just a single test do:
     ctest -R poisson_1 # argument is a regexp for test names

8. To see what make is doing run it like this:
     VERBOSE=1 make

9. To make some plots from the tests run them as follows. Some tests
   may fail due to bad random initial conditions, so re-run the tests
   a few times to see if failures persist.
     cd run_test/emission
     gnuplot plot_species.gnuplot

The NetCDF libraries are required to compile PartMC. The `netcdf.mod`
Fortran 90 module file is required, and it must be produced by the
same compiler being used to compile PartMC.

PartMC can interface to the MOSAIC chemistry code (see above for
availability) but this is not enabled by default. To use MOSAIC, set
the `ENABLE_MOSAIC` variable to `ON` in cmake. The
`MOSAIC_INCLUDE_DIR` variable should be the location of the MOSAIC
module files (compiled with the same compiler), probably ending in
`mosaic/datamodules`. The `MOSAIC_LIB` variable should end in
something like `mosaic/libmosaic.a`.


Usage
=====

The main `partmc` command reads `.spec` files and does the run
specified therein. Either Monte Carlo runs, sectional code runs, or
exact solutions can be generated. A run can produce binned summary
data in NetCDF format, or full per-particle state data in either
NetCDF or ASCII format. The extract_* programs in the tool/ directory
can read either summary or full-state NetCDF files and serve as
examples for processing the data.


Coding Conventions
==================

The code is mainly Fortran 90, with a few parts still clearly showing
their Fortran 77 heritage.

Extensive use is made of Fortran 90 derived types and pointers for
dynamic memory allocation of arrays inside derived types. Derived
types are named `my_type_t` and are generally defined in modules named
`pmc_mod_my_type` within files named `my_type.f90`. Each derived type
has allocation and deallocation functions `my_type_alloc()` and
`my_type_free()`, respectively.

Module names are always the same as the name of the containing file,
but prefixed with `pmc_mod_`. Thus the module `pmc_mod_condensation`
is contained in the file `condensation.f90`.


ChangeLog
=========

1.2.0 - XXXX-XX-XX

  * Output of full per-particle data in NetCDF format.

  * `urban_plume` test-case added, as described in the paper
    <http://arxiv.org/abs/0809.0875>

  * Build system switched to `cmake`.

  * Automated test suite added (`make test`).

1.1.0 - 2008-02-17

  * Internal reorganization to use Fortran 90 derived types for the
    data structures.

  * Integration with the MOSAIC gas- and aerosol-chemistry code.

  * Output is in binary NetCDF format.

  * Parallel implementation using 1D mixing.

1.0.0 - 2007-02-26

  * First release, including hierarchical coagulation and full water
    condensation.
